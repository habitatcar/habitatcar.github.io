<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HABITAT-CAR | ADMIN TUTORIALES</title>
    <style>
        :root { 
            --azul-oscuro: #0a192f;
            --azul-medio: #334766; 
            --azul-claro: #415a77;
            --celeste-habitat: #004a99;
            --blanco-suave: #e6f1ff;
            --oro: #ffc107; 
            --rojo: #dc3545;
            --verde: #28a745;
        }

        body { 
            font-family: 'Segoe UI', sans-serif; 
            background-color: var(--azul-oscuro); 
            color: var(--blanco-suave);
            margin: 0; 
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* HEADER & NAV UNIFICADO */
        .header {
            background: var(--azul-medio);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px solid var(--celeste-habitat);
            flex-wrap: wrap;
            gap: 15px;
            flex-shrink: 0;
        }
        .logo { height: 80px; width: auto; } 

        .nav-menu { 
            display: flex; 
            gap: 8px; 
            flex-wrap: wrap;
        }
        .nav-link {
            padding: 8px 12px;
            border-radius: 6px;
            text-decoration: none;
            color: white;
            font-weight: bold;
            background: var(--azul-claro);
            transition: 0.3s;
            font-size: 11px;
            text-transform: uppercase;
        }
        /* BOT√ìN ACTIVO EN ROJO */
        .nav-link.active { background: var(--rojo); box-shadow: 0 0 10px rgba(220,53,69,0.5); }

        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 20px; 
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            overflow: hidden;
            width: 100%;
            box-sizing: border-box;
        }

        /* FORMULARIO CARGA */
        .form-carga {
            background: var(--azul-medio);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        input, select { padding: 10px; border-radius: 5px; border: none; background: var(--blanco-suave); font-size: 14px; }
        .btn-add { background: var(--verde); color: white; font-weight: bold; cursor: pointer; border: none; border-radius: 5px; }

        /* GALER√çA CON SCROLL */
        .scroll-area {
            overflow-y: auto;
            flex-grow: 1;
            padding-right: 10px;
        }
        .grid-tutoriales {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .item-card {
            background: var(--azul-medio);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--azul-claro);
            transition: 0.3s;
        }
        .item-card:hover { transform: translateY(-5px); border-color: var(--oro); }

        .item-thumb-container { position: relative; cursor: pointer; aspect-ratio: 16/9; background: #000; }
        .item-thumb { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }
        .play-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 40px; color: white; opacity: 0.9; }

        .item-info { padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .item-info h3 { margin: 0; font-size: 1rem; color: var(--blanco-suave); }
        
        .btn-op { padding: 8px 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; font-size: 12px; }
    </style>
</head>
<body>

    <header class="header">
        <img src="https://github.com/habitatcar/habitatcar.github.io/blob/main/logo.png?raw=true" class="logo">
        <nav class="nav-menu">
            <a href="admin_comercios.html" class="nav-link">Comercios</a>
            <a href="admin_leads.html" class="nav-link">Leads</a>
            <a href="admin_vips.html" class="nav-link">Vips</a>
            <a href="admin_tokens_vip.html" class="nav-link">Tokens Vip</a>
            <a href="admin_curioso.html" class="nav-link">Curioso</a>
            <a href="admin_estadisticas.html" class="nav-link">Estad√≠sticas</a>
            <a href="admin_logs.html" class="nav-link">Log</a>
            <a href="admin_tutoriales.html" class="nav-link active">Tutoriales</a>
            <a href="index.html" class="nav-link">Panel de Ingreso</a>
            <a href="admin_legales.html" class="nav-link">Legales</a>
        </nav>
    </header>

    <div class="container">
        <div class="form-carga">
            <input type="text" id="t-titulo" placeholder="T√≠tulo del Video">
            <select id="t-tipo">
                <option value="todos">üåç Todos</option>
                <option value="lead">üë§ Solo Leads</option>
                <option value="vip">üíé Solo VIPs</option>
                <option value="leads_vips">üë• Leads y VIPs</option>
                <option value="comercio">üè™ Solo Comercios</option>
            </select>
            <input type="text" id="t-url" placeholder="URL de YouTube/Vimeo">
            <input type="text" id="t-preview" placeholder="URL Miniatura (Opcional)">
            <button class="btn-add" onclick="subir()">‚ûï PUBLICAR</button>
        </div>

        <div class="scroll-area">
            <div class="grid-tutoriales" id="t-display">
                </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD5M0kPsdU8Hk_YX3uEahfoQ5k9PD8SUXM",
            authDomain: "habitatcar-pro.firebaseapp.com",
            projectId: "habitatcar-pro",
            storageBucket: "habitatcar-pro.firebasestorage.app",
            messagingSenderId: "311691258694",
            appId: "1:311691258694:web:17a09051dcea7707af9347"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.subir = async () => {
            const titulo = document.getElementById('t-titulo').value;
            const tipo = document.getElementById('t-tipo').value;
            const url = document.getElementById('t-url').value;
            const preview = document.getElementById('t-preview').value;

            if(!titulo || !url) return alert("Completa t√≠tulo y URL");

            await addDoc(collection(db, "tutoriales"), {
                titulo, 
                tipo, 
                url, 
                preview: preview || 'https://via.placeholder.com/400x225?text=Habitat-Car',
                fecha: Date.now()
            });

            document.getElementById('t-titulo').value = "";
            document.getElementById('t-url').value = "";
            document.getElementById('t-preview').value = "";
        };

        const q = query(collection(db, "tutoriales"), orderBy("fecha", "desc"));
        onSnapshot(q, (snap) => {
            const container = document.getElementById('t-display');
            container.innerHTML = "";
            snap.forEach(d => {
                const t = d.data();
                const tipoTexto = {
                    'todos': 'TODOS',
                    'lead': 'LEADS',
                    'vip': 'VIPS',
                    'leads_vips': 'LEADS Y VIPS',
                    'comercio': 'COMERCIOS'
                }[t.tipo] || t.tipo.toUpperCase();

                container.innerHTML += `
                    <div class="item-card">
                        <div class="item-thumb-container" onclick="window.open('${t.url}', '_blank')">
                            <img src="${t.preview}" class="item-thumb">
                            <div class="play-icon">‚ñ∂Ô∏è</div>
                        </div>
                        <div class="item-info">
                            <div>
                                <h3 style="margin-bottom:5px;">${t.titulo}</h3>
                                <span style="background:var(--azul-claro); padding:2px 6px; border-radius:4px; font-size:10px; color:var(--oro); font-weight:bold;">${tipoTexto}</span>
                            </div>
                            <button class="btn-op" style="background:var(--rojo)" onclick="window.borrar('${d.id}')">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            });
        });

        window.borrar = async (id) => { 
            if(confirm("¬øEliminar este video tutorial?")) await deleteDoc(doc(db, "tutoriales", id)); 
        };
    </script>
</body>
</html>