<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Beneficios Habitat-Car</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f8f9fa;
      padding: 20px 16px;
      font-size: 22px;
      line-height: 1.5;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    .logo {
      width: 90%;
      max-width: 500px;
      display: block;
      margin: 0 auto 20px;
    }
    .titulo {
      color: #2c5aa0;
      font-size: 32px;
      text-align: center;
      font-weight: bold;
      margin-bottom: 25px;
    }
    .cupon {
      background: white;
      border-radius: 20px;
      padding: 30px 20px;
      margin: 30px 0;
      box-shadow: 0 5px 18px rgba(0,0,0,0.1);
    }
    .cupon.inactivo {
      background: #e0e0e0 !important;
      opacity: 1 !important;
      filter: grayscale(30%) brightness(90%);
    }
    .nombre {
      font-size: 28px;
      font-weight: bold;
      margin: 12px 0;
    }
    .descuento {
      font-size: 24px;
      margin: 12px 0;
      font-weight: bold;
    }
    .info {
      margin: 12px 0;
      font-size: 20px;
      line-height: 1.4;
    }
    .btn {
      display: block;
      width: 100%;
      padding: 16px;
      border-radius: 16px;
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      text-decoration: none;
      cursor: pointer;
      margin-top: 12px;
      border: none;
    }
    .btn-qr {
      background: #E91E63;
      color: white;
    }
    .btn-usar {
      background: #2c5aa0;
      color: white;
    }
    .btn-como-llegar {
      background: #4CAF50;
      color: white;
    }
    .btn:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }
    #grilla { display: block; }
    #exito { display: none; text-align: center; padding: 40px 20px; }
    #exito img {
      width: 95%;
      max-width: 500px;
      margin-bottom: 20px;
    }
    #contador {
      font-size: 60px;
      font-weight: bold;
      color: #d32f2f;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="/logo.png" alt="Habitat-Car" class="logo">
    <div class="titulo">üéÅ Tus beneficios Habitat-Car</div>

    <div id="grilla">
      <!-- Los comercios se generar√°n aqu√≠ -->
    </div>

    <div id="exito">
      <img src="/logo.png" alt="Habitat-Car">
      <h2>üéâ ¬°FELICITACIONES!</h2>
      <p id="exito-texto"></p>
      <div id="contador">30</div>
      <p>V√°lido por 30 segundos.</p>
    </div>
  </div>

  <script>
    const COMERCIOS = [
      { id: "cafex", nombre: "Cafex", beneficio: "10% en medialunas", direccion: "Pje. Suiza 897", telefono: "387584856", mapa: "https://maps.app.goo.gl/EnrwchwaueLCpHWZ6" },
      { id: "llavero", nombre: "Llaverito", beneficio: "15%", direccion: "Tilcara 319", telefono: "6546546665", mapa: "https://maps.app.goo.gl/EnrwchwaueLCpHWZ7" },
      { id: "fotocopias", nombre: "Fotocopiadora Ely", beneficio: "20%", direccion: "Quintana 226, San Salvador de Jujuy", telefono: "45685534", mapa: "" },
      { id: "pinturasx", nombre: "Pinturer√≠a", beneficio: "5% en l√°tex", direccion: "√âxodo 476, San Salvador de Jujuy", telefono: "", mapa: "" }
    ];

    // Estados
    let usos = JSON.parse(localStorage.getItem('usosHabitatCar') || '{}');
    let validados = JSON.parse(localStorage.getItem('validadosHabitatCar') || '{}');

    function mostrarGrilla() {
      document.getElementById('grilla').style.display = 'block';
      document.getElementById('exito').style.display = 'none';

      const grilla = document.getElementById('grilla');
      grilla.innerHTML = '';

      COMERCIOS.forEach(com => {
        const usado = usos[com.id];
        const cupon = document.createElement('div');
        cupon.className = `cupon ${usado ? 'inactivo' : ''}`;
        cupon.innerHTML = `
          <div class="nombre">${com.nombre}</div>
          <div class="descuento">${com.beneficio}</div>
          <div class="info"><strong>üìç Direcci√≥n:</strong> ${com.direccion}</div>
          ${com.telefono ? `<div class="info"><strong>üìû Tel√©fono:</strong> <a href="tel:${com.telefono}">${com.telefono}</a></div>` : ''}
          <div style="margin-top:20px; display:flex; flex-direction:column; gap:12px;">
            ${!usado ? 
              `<button class="btn btn-qr" onclick="simularQR('${com.id}')">Validar Cup√≥n con QR en comercio</button>` :
              `<div style="text-align:center; color:#b71c1c; font-weight:bold;">‚úÖ Beneficio ya utilizado</div>`
            }
            ${com.mapa ? `<a href="${com.mapa}" target="_blank" class="btn btn-como-llegar">C√≥mo llegar</a>` : ''}
            <button class="btn btn-usar" id="btn-usar-${com.id}" ${usado || !validados[com.id] ? 'disabled' : ''} onclick="usar('${com.id}', '${com.nombre}', '${com.beneficio}')">Usar el beneficio</button>
          </div>
        `;
        grilla.appendChild(cupon);
      });

      // Activar botones ya validados
      COMERCIOS.forEach(com => {
        if (validados[com.id] && !usos[com.id]) {
          document.getElementById(`btn-usar-${com.id}`).disabled = false;
        }
      });
    }

    function simularQR(comercioId) {
      // Simular validaci√≥n
      validados[comercioId] = true;
      localStorage.setItem('validadosHabitatCar', JSON.stringify(validados));
      document.getElementById(`btn-usar-${comercioId}`).disabled = false;
      alert("‚úÖ QR validado. Ahora pod√©s usar el beneficio.");
    }

    function usar(comercioId, nombre, beneficio) {
      if (!validados[comercioId]) {
        alert("‚ö†Ô∏è Primero deb√©s validar el cup√≥n con QR en el comercio.");
        return;
      }
      if (usos[comercioId]) {
        alert("‚úÖ Este beneficio ya fue utilizado.");
        return;
      }

      if (!confirm("¬øAvisaste al cajero que usar√°s el cup√≥n?\nSi no le avisaste, perd√©s la validez.")) {
        return;
      }

      // Marcar como usado
      usos[comercioId] = true;
      localStorage.setItem('usosHabitatCar', JSON.stringify(usos));

      // Mostrar √©xito
      document.getElementById('exito-texto').textContent = `Beneficio activado en ${nombre}. ${beneficio}`;
      document.getElementById('grilla').style.display = 'none';
      document.getElementById('exito').style.display = 'block';

      // Contador
      let contador = 30;
      const elem = document.getElementById('contador');
      const interval = setInterval(() => {
        contador--;
        elem.textContent = contador;
        if (contador <= 0) {
          clearInterval(interval);
          setTimeout(() => {
            mostrarGrilla(); // Vuelve a la grilla
          }, 1000);
        }
      }, 1000);
    }

    // Iniciar
    mostrarGrilla();
  </script>
</body>
</html>
