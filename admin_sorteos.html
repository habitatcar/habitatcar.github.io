1. Actualizaci√≥n de la l√≥gica de Sorteo (Captura de Datos)
Modifica la funci√≥n ejecutarSorteo para que guarde el logo y el nombre completo:

JavaScript

const ejecutarSorteo = async (idCom, nomCom, premio, cant, mailC) => {
    mostrarToast(`üé≤ Verificando participantes para ${nomCom}...`, "warning");
    
    try {
        // Obtenemos primero el logo del comercio actual
        const qC = query(collection(db, "comercios"), where("nombre", "==", nomCom));
        const snapC = await getDocs(qC);
        let logoComercio = "";
        snapC.forEach(d => logoComercio = d.data().logoUrl || "");

        const q = query(collection(db, "admin_participantes_sorteos"), where("comercio", "==", nomCom));
        const snap = await getDocs(q);
        
        let participantes = [];
        snap.forEach(d => {
            let data = d.data();
            // ‚úÖ PRIORIDAD DE NOMBRE: Si es LEAD suele ser 'nombre' y 'apellido'
            // Si es VIP suele ser 'usuario' o 'nombre'
            const nombreReal = data.nombre || data.usuario || "Participante";
            const apellidoReal = data.apellido || "";
            data.nombreCompleto = `${nombreReal} ${apellidoReal}`.trim();
            data.nombreMostrar = data.nombreCompleto; 
            participantes.push(data);
        });
        
        if (participantes.length === 0) {
            mostrarToast(`‚ö†Ô∏è Sin participantes en "${nomCom}".`, "error");
            return; 
        }

        let bolsa = [...participantes];
        let ganadores = [];
        const limite = Math.min(cant, bolsa.length);
        
        for (let i = 0; i < limite; i++) {
            const idx = Math.floor(Math.random() * bolsa.length);
            ganadores.push(bolsa.splice(idx, 1)[0]);
        }

        // ‚úÖ GUARDAMOS LOGO Y NOMBRE COMPLETO EN EL HISTORIAL
        await addDoc(collection(db, "historial_sorteos"), { 
            comercio: nomCom, 
            logoUrl: logoComercio, // Guardamos el logo aqu√≠ para el historial
            premio: premio, 
            ganadores: ganadores, 
            fecha: serverTimestamp(),
            mailComercio: mailC || 'habitatcar@gmail.com'
        });
        
        mostrarToast(`‚úÖ ¬°Sorteo realizado!`, "success");
        window.mostrarConfirmacionSorteo(participantes.length, ganadores);
        
    } catch (e) {
        console.error(e);
        mostrarToast("‚ùå Error al conectar.", "error");
    }
};
2. Actualizaci√≥n del Historial (Renderizado de Logo y Nombres)
Reemplaza tu funci√≥n window.mostrarHistorial por esta versi√≥n mejorada:

JavaScript

window.mostrarHistorial = () => {
    const tabla = document.getElementById('tabla-sorteos');
    tabla.innerHTML = "<tr><td colspan='6' style='text-align:center'>Cargando historial...</td></tr>";
    
    // Cambiamos el color de fondo de la tabla para diferenciar que es historial
    tabla.style.opacity = "0";

    onSnapshot(collection(db, "historial_sorteos"), (snap) => {
        tabla.innerHTML = "";
        tabla.style.opacity = "1";

        if (snap.empty) {
            tabla.innerHTML = "<tr><td colspan='6' style='text-align:center;padding:40px;color:#666;'>No hay sorteos en el historial.</td></tr>";
            return;
        }

        // Ordenar por fecha (los m√°s nuevos primero si es posible localmente o por query)
        const docs = snap.docs.sort((a, b) => (b.data().fecha?.seconds || 0) - (a.data().fecha?.seconds || 0));

        docs.forEach(doc => {
            const h = doc.data();
            const fechaObj = h.fecha?.toDate ? h.fecha.toDate() : new Date();
            const fecha = fechaObj.toLocaleDateString('es-AR');
            const hora = fechaObj.toLocaleTimeString('es-AR', {hour: '2-digit', minute:'2-digit'});

            h.ganadores?.forEach(g => {
                const cel = g.celular || g.telefono || '';
                const email = g.email || '';
                // ‚úÖ Usamos el nombre completo procesado o el que encuentre
                const nombreGanador = g.nombreCompleto || g.nombreMostrar || g.nombre || "Sin Nombre";
                const tipoParticipante = g.tipo || "LEAD";

                tabla.innerHTML += `
                <tr style="border-left: 5px solid var(--oro); background: #fff;">
                    <td>
                        <div class="fecha-cell">
                            <span class="fecha-principal">${fecha}</span>
                            <span class="hora-secundaria">${hora} Hs</span>
                        </div>
                    </td>
                    <td>
                        <img src="${h.logoUrl || 'https://github.com/habitatcar/habitatcar.github.io/blob/main/logo.png?raw=true'}" 
                             class="logo-mini" alt="Logo">
                    </td>
                    <td>
                        <span class="badge badge-comercio">${h.comercio}</span><br>
                        <b style="color:var(--azul-habitat)">${nombreGanador}</b> 
                        <small>(${tipoParticipante})</small><br>
                        <span class="badge badge-premio" style="margin-top:5px">üéÅ ${h.premio}</span>
                    </td>
                    <td style="text-align:center">-</td>
                    <td>
                        <div style="display:flex; gap:4px; flex-wrap:wrap">
                            <button class="btn-accion btn-wa" onclick="abrirWA('${cel}','${nombreGanador}','${h.premio}')">
                                <i class="fab fa-whatsapp"></i> WA
                            </button>
                            <button class="btn-accion btn-mail" onclick="enviarMail(this,'${email}','${nombreGanador}','${h.premio}','${h.comercio}','${h.mailComercio || ''}')">
                                <i class="fas fa-envelope"></i> MAIL
                            </button>
                        </div>
                    </td>
                    <td>
                        <button class="btn-accion btn-copy" onclick="navigator.clipboard.writeText('${nombreGanador} - ${email} - ${cel}'); mostrarToast('Copiado','warning')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </td>
                </tr>`;
            });
        });
    });
    mostrarToast("üìú Historial de √âxitos actualizado", "success");
};
